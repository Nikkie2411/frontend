<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Device ID</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .device-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .device-id {
            font-size: 18px;
            font-weight: bold;
            color: #2c5aa0;
            word-break: break-all;
        }
        .fingerprint-details {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
            line-height: 1.6;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .comparison {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test Device ID Generator</h1>
        <p>Test n√†y s·∫Ω hi·ªÉn th·ªã Device ID ƒë∆∞·ª£c t·∫°o t·ª´ hardware fingerprint. M·ªü trang n√†y tr√™n nhi·ªÅu tr√¨nh duy·ªát kh√°c nhau tr√™n c√πng thi·∫øt b·ªã ƒë·ªÉ ki·ªÉm tra t√≠nh nh·∫•t qu√°n.</p>
        
        <button onclick="generateDeviceId()">üîÑ T·∫°o Device ID</button>
        <button onclick="clearResults()">üóëÔ∏è X√≥a k·∫øt qu·∫£</button>
        <button onclick="testDifferentMethods()">üî¨ So s√°nh c√°c ph∆∞∆°ng ph√°p</button>
        
        <div id="results"></div>
        
        <div class="comparison">
            <h3>üìã C√°ch ki·ªÉm tra:</h3>
            <ol>
                <li>M·ªü trang n√†y tr√™n <strong>C·ªëc c·ªëc</strong> v√† ghi l·∫°i Device ID</li>
                <li>M·ªü trang n√†y tr√™n <strong>Edge</strong> (c√πng thi·∫øt b·ªã) v√† so s√°nh Device ID</li>
                <li>M·ªü trang n√†y tr√™n <strong>Chrome</strong> (c√πng thi·∫øt b·ªã) v√† so s√°nh Device ID</li>
                <li>M·ªü trang n√†y tr√™n <strong>Firefox</strong> (c√πng thi·∫øt b·ªã) v√† so s√°nh Device ID</li>
                <li>N·∫øu Device ID gi·ªëng nhau tr√™n t·∫•t c·∫£ tr√¨nh duy·ªát = <span style="color: green; font-weight: bold;">‚úÖ TH√ÄNH C√îNG!</span></li>
            </ol>
            <div style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 10px;">
                <strong>üí° L∆∞u √Ω:</strong> Phi√™n b·∫£n m·ªõi n√†y ch·ªâ s·ª≠ d·ª•ng th√¥ng tin ph·∫ßn c·ª©ng ·ªïn ƒë·ªãnh nh·∫•t:
                <ul style="margin: 5px 0; padding-left: 20px;">
                    <li>K√≠ch th∆∞·ªõc m√†n h√¨nh (screen resolution)</li>
                    <li>ƒê·ªô s√¢u m√†u (color depth)</li>
                    <li>M√∫i gi·ªù (timezone)</li>
                    <li>S·ªë l√µi CPU (CPU cores)</li>
                    <li>Dung l∆∞·ª£ng RAM (device memory)</li>
                    <li>H·ªó tr·ª£ c·∫£m ·ª©ng (touch points)</li>
                    <li>Platform ƒë√£ chu·∫©n h√≥a</li>
                </ul>
            </div>
        </div>
        
        <div id="comparison-section" style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0;">
            <h3>üìä So s√°nh Device ID</h3>
            <button onclick="addToComparison()">‚ûï Th√™m Device ID hi·ªán t·∫°i v√†o so s√°nh</button>
            <button onclick="clearComparison()">üóëÔ∏è X√≥a so s√°nh</button>
            <div id="comparison-results"></div>
        </div>
        
        <div id="storage-test">
            <h3>üíæ Storage Test</h3>
            <button onclick="saveToStorage()">L∆∞u v√†o localStorage</button>
            <button onclick="loadFromStorage()">ƒê·ªçc t·ª´ localStorage</button>
            <button onclick="clearStorage()">X√≥a localStorage</button>
            <div id="storage-result"></div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script>
        let generateCount = 0;
        
        async function generateDeviceId() {
            try {
                generateCount++;
                const startTime = performance.now();
                const { deviceId, deviceName } = await getDeviceId();
                const endTime = performance.now();
                const generateTime = Math.round(endTime - startTime);
                
                const resultDiv = document.getElementById('results');
                const resultHtml = `
                    <div class="device-info">
                        <h3>üÜî L·∫ßn t·∫°o #${generateCount} (${new Date().toLocaleTimeString()})</h3>
                        <div class="device-id">Device ID: ${deviceId}</div>
                        <p><strong>Device Name:</strong> ${deviceName}</p>
                        <p><strong>Th·ªùi gian t·∫°o:</strong> ${generateTime}ms</p>
                        <p><strong>Tr√¨nh duy·ªát:</strong> ${navigator.userAgent}</p>
                    </div>
                `;
                
                resultDiv.innerHTML = resultHtml + resultDiv.innerHTML;
                
                // Hi·ªÉn th·ªã th√¥ng tin fingerprint chi ti·∫øt
                showFingerprintDetails();
                
            } catch (error) {
                console.error('L·ªói t·∫°o Device ID:', error);
                document.getElementById('results').innerHTML = `
                    <div style="background: #ffebee; padding: 15px; border-radius: 5px; color: #c62828;">
                        <h3>‚ùå L·ªói</h3>
                        <p>${error.message}</p>
                    </div>
                ` + document.getElementById('results').innerHTML;
            }
        }
        
        function showFingerprintDetails() {
            // Chu·∫©n h√≥a platform
            let platformInfo = navigator.platform.toLowerCase();
            if (platformInfo.includes('win')) platformInfo = 'windows';
            else if (platformInfo.includes('mac')) platformInfo = 'macos';
            else if (platformInfo.includes('linux')) platformInfo = 'linux';
            else if (platformInfo.includes('android')) platformInfo = 'android';
            else if (platformInfo.includes('iphone') || platformInfo.includes('ipad')) platformInfo = 'ios';
            
            const details = {
                'üì∫ Screen Width': screen.width,
                'üì∫ Screen Height': screen.height,
                'üíª Platform (normalized)': platformInfo,
                'ÔøΩ Raw Platform': navigator.platform,
                '‚ö†Ô∏è NOTE': 'Ultra-simple method ch·ªâ s·ª≠ d·ª•ng 3 th√¥ng tin tr√™n'
            };
            
            // T√≠nh to√°n signature nh∆∞ trong code th·ª±c (ultra-simple version)
            const ultraSimpleSignature = [
                screen.width,
                screen.height,
                platformInfo
            ].join('|');
            
            let detailsHtml = '<div class="fingerprint-details">';
            detailsHtml += '<h4>üîç Ultra-Simple Hardware Fingerprint:</h4>';
            
            for (const [key, value] of Object.entries(details)) {
                detailsHtml += `<strong>${key}:</strong> ${value}<br>`;
            }
            
            detailsHtml += '<br><strong>üîê Signature:</strong><br>';
            detailsHtml += `<code style="background: #f0f0f0; padding: 5px; border-radius: 3px; word-break: break-all;">${ultraSimpleSignature}</code><br><br>`;
            
            // T√≠nh hash ƒë·ªÉ so s√°nh
            let hash = 0;
            for (let i = 0; i < ultraSimpleSignature.length; i++) {
                const char = ultraSimpleSignature.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            const computedId = Math.abs(hash).toString(36).padStart(8, '0').slice(0, 8);
            detailsHtml += `<strong>üÜî Computed Device ID:</strong> <span style="color: #2c5aa0; font-weight: bold;">${computedId}</span>`;
            
            detailsHtml += '</div>';
            
            const resultDiv = document.getElementById('results');
            resultDiv.innerHTML = detailsHtml + resultDiv.innerHTML;
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            generateCount = 0;
        }
        
        function saveToStorage() {
            const testData = {
                timestamp: new Date().toISOString(),
                browser: navigator.userAgent.split(' ').pop(),
                savedAt: Date.now()
            };
            localStorage.setItem('deviceIdTest', JSON.stringify(testData));
            updateStorageDisplay();
        }
        
        function loadFromStorage() {
            updateStorageDisplay();
        }
        
        function clearStorage() {
            localStorage.removeItem('deviceIdTest');
            updateStorageDisplay();
        }
        
        function updateStorageDisplay() {
            const stored = localStorage.getItem('deviceIdTest');
            const resultDiv = document.getElementById('storage-result');
            
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    resultDiv.innerHTML = `
                        <div style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 10px;">
                            <strong>üì¶ Data trong localStorage:</strong><br>
                            Th·ªùi gian l∆∞u: ${data.timestamp}<br>
                            Tr√¨nh duy·ªát: ${data.browser}<br>
                            Timestamp: ${data.savedAt}
                        </div>
                    `;
                } catch (e) {
                    resultDiv.innerHTML = `<div style="color: red;">L·ªói parse data: ${e.message}</div>`;
                }
            } else {
                resultDiv.innerHTML = `
                    <div style="background: #ffebee; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        ‚ùå Kh√¥ng c√≥ data trong localStorage
                    </div>
                `;
            }
        }
        
        // T·ª± ƒë·ªông t·∫°o Device ID khi t·∫£i trang
        window.addEventListener('DOMContentLoaded', () => {
            generateDeviceId();
            updateStorageDisplay();
            loadComparison();
        });
        
        // Comparison functions
        let comparisonData = [];
        
        async function addToComparison() {
            try {
                const { deviceId, deviceName } = await getDeviceId();
                const browserInfo = getBrowserInfo();
                
                const entry = {
                    deviceId,
                    deviceName,
                    browser: browserInfo,
                    timestamp: new Date().toLocaleString(),
                    userAgent: navigator.userAgent
                };
                
                // Ki·ªÉm tra xem ƒë√£ c√≥ entry c·ªßa browser n√†y ch∆∞a
                const existingIndex = comparisonData.findIndex(item => item.browser === browserInfo);
                if (existingIndex !== -1) {
                    comparisonData[existingIndex] = entry; // Update
                } else {
                    comparisonData.push(entry); // Add new
                }
                
                saveComparison();
                updateComparisonDisplay();
                
            } catch (error) {
                console.error('Error adding to comparison:', error);
            }
        }
        
        function getBrowserInfo() {
            const ua = navigator.userAgent.toLowerCase();
            if (ua.includes('coccoc')) return 'C·ªëc c·ªëc';
            if (ua.includes('edg/')) return 'Microsoft Edge';
            if (ua.includes('chrome') && !ua.includes('edg')) return 'Google Chrome';
            if (ua.includes('firefox')) return 'Mozilla Firefox';
            if (ua.includes('safari') && !ua.includes('chrome')) return 'Safari';
            if (ua.includes('opera')) return 'Opera';
            return 'Unknown Browser';
        }
        
        function clearComparison() {
            comparisonData = [];
            localStorage.removeItem('deviceIdComparison');
            updateComparisonDisplay();
        }
        
        function saveComparison() {
            localStorage.setItem('deviceIdComparison', JSON.stringify(comparisonData));
        }
        
        function loadComparison() {
            const stored = localStorage.getItem('deviceIdComparison');
            if (stored) {
                try {
                    comparisonData = JSON.parse(stored);
                    updateComparisonDisplay();
                } catch (e) {
                    console.error('Error loading comparison data:', e);
                }
            }
        }
        
        function updateComparisonDisplay() {
            const resultDiv = document.getElementById('comparison-results');
            
            if (comparisonData.length === 0) {
                resultDiv.innerHTML = '<p style="color: #666; font-style: italic;">Ch∆∞a c√≥ d·ªØ li·ªáu so s√°nh</p>';
                return;
            }
            
            // Ki·ªÉm tra t√≠nh nh·∫•t qu√°n c·ªßa Device ID
            const uniqueDeviceIds = [...new Set(comparisonData.map(item => item.deviceId))];
            const isConsistent = uniqueDeviceIds.length === 1;
            
            let html = `
                <div style="margin-top: 15px;">
                    <h4>üìä K·∫øt qu·∫£ so s√°nh (${comparisonData.length} tr√¨nh duy·ªát)</h4>
                    <div style="background: ${isConsistent ? '#d4edda' : '#f8d7da'}; color: ${isConsistent ? '#155724' : '#721c24'}; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                        <strong>${isConsistent ? '‚úÖ TH√ÄNH C√îNG' : '‚ùå TH·∫§T B·∫†I'}:</strong> 
                        ${isConsistent ? 'Device ID nh·∫•t qu√°n tr√™n t·∫•t c·∫£ tr√¨nh duy·ªát!' : `Ph√°t hi·ªán ${uniqueDeviceIds.length} Device ID kh√°c nhau!`}
                    </div>
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: #e9ecef;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Tr√¨nh duy·ªát</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Device ID</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Th·ªùi gian test</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            comparisonData.forEach(item => {
                const isMainDeviceId = item.deviceId === uniqueDeviceIds[0];
                html += `
                    <tr style="background: ${isMainDeviceId ? '#f8f9fa' : '#fff3cd'};">
                        <td style="border: 1px solid #ddd; padding: 8px;">${item.browser}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; font-family: monospace; font-weight: bold;">
                            ${item.deviceId}
                            ${!isMainDeviceId ? ' ‚ö†Ô∏è' : ''}
                        </td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${item.timestamp}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            if (!isConsistent) {
                html += `
                    <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <strong>üîç Device IDs kh√°c nhau:</strong><br>
                        ${uniqueDeviceIds.map((id, index) => `${index + 1}. <code>${id}</code>`).join('<br>')}
                    </div>
                `;
            }
            
            resultDiv.innerHTML = html;
        }
        
        async function testDifferentMethods() {
            try {
                console.log('üî¨ Testing different Device ID methods...');
                const comparison = await compareDeviceIdMethods();
                
                const resultDiv = document.getElementById('results');
                const testResult = `
                    <div class="device-info" style="background: #e3f2fd;">
                        <h3>üî¨ So s√°nh c√°c ph∆∞∆°ng ph√°p t·∫°o Device ID</h3>
                        <p><strong>Ultra Simple (current):</strong> <code>${comparison.ultraSimpleId}</code></p>
                        <p><strong>Screen + Platform:</strong> <code>${comparison.screenPlatformId}</code></p>
                        <p><strong>Screen Only:</strong> <code>${comparison.screenOnlyId}</code></p>
                        <p><strong>Signature:</strong> <code>${comparison.signature}</code></p>
                        <p><strong>K·∫øt qu·∫£:</strong> ${comparison.ultraSimpleId === comparison.screenPlatformId ? '‚úÖ Methods match' : '‚ùå Methods differ'}</p>
                        <p><em>Ki·ªÉm tra console ƒë·ªÉ xem chi ti·∫øt so s√°nh.</em></p>
                    </div>
                `;
                
                resultDiv.innerHTML = testResult + resultDiv.innerHTML;
                
            } catch (error) {
                console.error('L·ªói test methods:', error);
            }
        }
    </script>
</body>
</html>
